[tox]
envlist = py39, py310, py311, py312, lint, type, security, benchmark
skip_missing_interpreters = true

[testenv]
deps = -e .[dev]
commands =
    python -m pytest -q {posargs:tests}
    python -m mypy opengov_earlyjapanese
    python -m ruff check opengov_earlyjapanese tests
setenv =
    PYTHONPATH = {toxinidir}

[testenv:lint]
deps = -e .[dev]
commands =
    python -m ruff check opengov_earlyjapanese tests
    python -m black --check opengov_earlyjapanese tests
    python -m isort --check-only opengov_earlyjapanese tests

[testenv:type]
deps = -e .[dev]
commands =
    python -m mypy opengov_earlyjapanese

[testenv:security]
deps = -e .[dev]
commands =
    python -m bandit -r opengov_earlyjapanese -c pyproject.toml
    python -m safety check

[testenv:benchmark]
deps = -e .[dev]
commands =
    python -m pytest tests/benchmarks/ -m benchmark --benchmark-json=benchmark.json

[testenv:coverage]
deps = -e .[dev]
commands =
    python -m pytest --cov=opengov_earlyjapanese --cov-report=term-missing --cov-report=xml --cov-report=html {posargs:tests}

[testenv:integration]
deps = -e .[dev]
commands =
    python -m pytest tests/integration/ -m integration -q

[testenv:e2e]
deps = -e .[dev]
commands =
    python -m pytest tests/e2e/ -m e2e -q

[testenv:property]
deps = -e .[dev]
commands =
    python -m pytest tests/property/ -m property -q

[testenv:docs]
deps =
    mkdocs>=1.5.0
    mkdocs-material>=9.0.0
commands =
    mkdocs build

[testenv:clean]
deps =
commands =
    python -c "import shutil; shutil.rmtree('build', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('dist', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.pytest_cache', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.coverage', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('htmlcov', ignore_errors=True)"